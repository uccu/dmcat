- extends "base.haml"


- block body
    
    .wrapper.wrapper-content
        .row
            .col-sm-12
                #modal_new.ibox.float-e-margins
                    .ibox-title
                        %h3 
                    .ibox-content
                        %form.form-horizontal.animated.fadeInRight(method="post")
                            
                        .ibox-title.optBox
                            
                            %button.btn.btn-success.flesh(type="button" onclick="location.reload()") 刷新

    
- block otherCss
    :css
        .modal-backdrop.in{z-index:1049 !important}

    %link(href="/css/plugins/summernote/summernote.css" rel="stylesheet")
    %link(href="/css/plugins/summernote/summernote-bs3.css" rel="stylesheet")

                        



- block otherScript
    %script(src="/js/plugins/summernote/summernote.min.js")
    %script(src="/js/plugins/summernote/summernote-zh-CN.js")
    %script(src="/js/plugins/suggest/bootstrap-suggest.min.js")
    :javascript
        $(function(j){
            
            

            var wget = function(d){
                var p =new URL(location);
                return p.searchParams.get(d);
            }

            var g,f

            g = function(){
                f=new WebSocket('ws://www.disuyijian.com:7777/admin')
                f.onopen = function(){
                    console.log('admin 连接成功')
                    f.send(JSON.stringify({"type":"login","id":Math.random(),"token":"mm"}))
                }
                f.onclose = function(){
                    console.log('admin 2秒后重连')
                    setTimeout(g,2000)
                }

                f.onmessage = function(z){

                    var obj = JSON.parse(z.data)

                    if(obj.status != 200)toastr['error'](obj.message);
                    else if(obj.type == 'pushDrivingOrder'){
                        curl_succ('派单成功')
                    }
                }
            }
            g()

            var get = wget('get');
            var id = wget('id');

            window.Dmcat.submFunc = function(){

                f.send(JSON.stringify({type:"pushDrivingOrder",id:$('[name="id"]').val(),trip_id:$('[name="trip_id"]').val(),driver_id:$('[name="toDriver"]').val()}))

            }

            var e = new Dmcat.admin(get,{id:id},'info');

            var su = 1
            

        });


    
        